// ignore_for_file: prefer_const_constructors, must_be_immutable, no_leading_underscores_for_local_identifiers, non_constant_identifier_names, prefer_const_constructors_in_immutables, prefer_interpolation_to_compose_strings, use_build_context_synchronously, unused_local_variable

import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:deogracias/interface/commander_next_page.dart';
import 'package:deogracias/interface/drawer_client.dart';
import 'package:deogracias/provider/provider_gestion_commande.dart';
import 'package:deogracias/provider/provider_gestion_departement.dart';
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_tts/flutter_tts.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:intl/intl.dart';
import 'package:mailer/mailer.dart';
import 'package:mailer/smtp_server/gmail.dart';
import 'package:provider/provider.dart';
import 'package:dropdown_search/dropdown_search.dart';

class Commande extends StatefulWidget {
  Commande({super.key});

  @override
  State<Commande> createState() => _CommandeState();
}

class _CommandeState extends State<Commande> {
  bool nom_bool = false;
  bool email_bool = false;
  bool numero_bool = false;
  bool achat_bool = false;
  bool description_bool = false;
  bool exigences_bool = false;
  bool is_empty = true;
  String client_uid = "";
  String nom = "";

  String email = "";

  String numero = "";

  String achat = "";

  String description = "";

  TextEditingController date_livraison = TextEditingController();
  TextEditingController nom_controller = TextEditingController();
  TextEditingController heure_livraison = TextEditingController();
  String exigences_client = "";

  String departement = "DONGA";

  String commu = "";

  String arrondissement = "SEMERE 2";

  String village = "N'DJAKADA";

  bool affiche = false;

  String pays = "BENIN";

  bool venir_chercher = true;
  int nombre = 0;

  @override
  void initState() {
    super.initState();
    _speak("renseignez bien les informations");
  }

  @override
  Widget build(BuildContext context) {
    final gestion_commande = Provider.of<ProviderGestionCommande>(context);
    nom = gestion_commande.nom;
    email = gestion_commande.email;
    numero = gestion_commande.numero;
    achat = gestion_commande.achat;
    description = gestion_commande.description;
    exigences_client = gestion_commande.exigences;
    final _provider = Provider.of<ProviderGestionDepartement>(context);
    nom_bool = gestion_commande.nom_bool;
    email_bool = gestion_commande.email_bool;
    numero_bool = gestion_commande.numero_bool;
    achat_bool = gestion_commande.achat_bool;
    description_bool = gestion_commande.description_bool;
    exigences_bool = gestion_commande.exigences_bool;
    venir_chercher = _provider.venir_chercher;
    departement = _provider.departement;
    commu = _provider.commune;
    arrondissement = _provider.arrondissement;
    village = _provider.village;
    affiche = _provider.affiche;
    pays = _provider.pays;

    return Scaffold(
      drawer: DrawerClient(),
      backgroundColor: Colors.green.shade800,
      appBar: AppBar(
        iconTheme: IconThemeData(color: Colors.black),
        actions: [
          Image.asset(
            "images/icon2.jpg",
            scale: 4.5,
            height: 100,
            width: 100,
          ),
        ],
        backgroundColor: Colors.white,
        elevation: 0,
        centerTitle: true,
        title: Text(
          "Passer une commande",
          style: GoogleFonts.alike(
              color: Colors.black, fontWeight: FontWeight.bold, fontSize: 16),
        ),
      ),
      body: SingleChildScrollView(
        scrollDirection: Axis.vertical,
        child: Column(
          children: [
            SizedBox(
              height: 0,
            ),
            Container(
              height: MediaQuery.of(context).size.height * 0.3,
              width: double.infinity,
              decoration: BoxDecoration(
                  borderRadius: BorderRadius.only(
                      bottomLeft: Radius.circular(40),
                      bottomRight: Radius.circular(40)),
                  image: DecorationImage(
                      image: AssetImage(
                        "images/image2.jpeg",
                      ),
                      fit: BoxFit.cover)),
            ),
            SizedBox(
              height: 50,
            ),
            Text(
              "Passer une commande",
              textAlign: TextAlign.center,
              style: GoogleFonts.alike(
                  color: Colors.white,
                  fontSize: 21,
                  fontWeight: FontWeight.bold),
            ),
            SizedBox(
              height: 10,
            ),
            Container(
              alignment: Alignment.center,
              height: 2,
              width: 80,
              color: Colors.white,
            ),
            SizedBox(
              height: 40,
            ),
            Container(
              alignment: Alignment.center,
              width: MediaQuery.of(context).size.width * 0.9,
              height: 50,
              decoration: BoxDecoration(
                  border: Border.all(
                      style: BorderStyle.solid,
                      width: 3,
                      color: Colors.redAccent)),
              child: Text(
                "renseigner bien vos informations".toUpperCase(),
                textAlign: TextAlign.center,
                style: TextStyle(
                    color: Colors.white,
                    fontSize: 12,
                    fontWeight: FontWeight.bold),
              ),
            ),
            SizedBox(
              height: 40,
            ),
            Container(
              alignment: Alignment.centerLeft,
              child: Padding(
                padding: const EdgeInsets.only(left: 15, bottom: 15),
                child: Text(
                  "Pays",
                  style: GoogleFonts.alike(
                      color: Colors.white,
                      fontWeight: FontWeight.bold,
                      fontSize: 20),
                ),
              ),
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15),
              child: DropdownButton<String>(
                  value: pays,
                  iconSize: 0.0,
                  isDense: true,
                  isExpanded: true,
                  items: <String>[
                    "BENIN",
                    "TOGO",
                  ].map<DropdownMenuItem<String>>((String value) {
                    return DropdownMenuItem<String>(
                        value: value, child: Text(value));
                  }).toList(),
                  onChanged: (newValue) {
                    _provider.change_pays(newValue!);
                  }),
            ),
            pays == "TOGO"
                ? Container()
                : Column(children: [
                    SizedBox(
                      height: 40,
                    ),
                    Container(
                      alignment: Alignment.centerLeft,
                      child: Padding(
                        padding: const EdgeInsets.only(left: 15, bottom: 15),
                        child: Text(
                          "DÃ©partement",
                          style: TextStyle(
                              color: Colors.white,
                              fontWeight: FontWeight.bold,
                              fontSize: 20),
                        ),
                      ),
                    ),
                    Padding(
                      padding: const EdgeInsets.only(left: 15),
                      child: DropdownSearch<String>(
                          popupProps: PopupProps.dialog(
                            showSelectedItems: false,
                            showSearchBox: true,
                          ),
                          selectedItem: departement,
                          items: <String>[
                            "DONGA",
                            "ATACORA",
                            "ATLANTIQUE",
                            "BORGOU",
                            "ALIBORI",
                            "COUFFO",
                            "ZOU",
                            "COLLINES",
                            "PLATEAU",
                            "LITTORAL",
                            "OUEME",
                            "MONO"
                          ].map((value) => value).toList(),
                          onChanged: (newValue) {
                            _provider.change_departement(newValue!);
                          }),
                    ),
                    SizedBox(
                      height: 40,
                    ),
                    Container(
                      alignment: Alignment.centerLeft,
                      child: Padding(
                        padding: const EdgeInsets.only(left: 15, bottom: 15),
                        child: Text(
                          "Commune",
                          style: TextStyle(
                              color: Colors.white,
                              fontWeight: FontWeight.bold,
                              fontSize: 20),
                        ),
                      ),
                    ),
                    Padding(
                      padding: const EdgeInsets.only(left: 15),
                      child: DropdownSearch<String>(
                          popupProps: PopupProps.dialog(
                            showSelectedItems: false,
                            showSearchBox: true,
                          ),
                          selectedItem: commu,

                          // ignore: prefer_const_literals_to_create_immutables
                          items: <String>[
                            "OUAKE",
                            "BASSILA",
                            "COPARGO",
                            "DJOUGOU",
                            "NATITINGOU",
                            "KEROU",
                            "KOUANDE",
                            "PEHUNCO",
                            "COBLY",
                            "BOUKOUMBE",
                            "MATERI",
                            "TOUCOUNTOUNA",
                            "TANGUIETA"
                                "ABOMEY-CALAVI",
                            "ALLADA",
                            "KPOMASSE",
                            "OUIDAH",
                            "SO-AVA",
                            "TOFFO",
                            "ZE",
                            "TORI-BOSSITO"
                                "N'DALI",
                            "NIKKI",
                            "KALALE",
                            "PERERE",
                            "SINENDE",
                            "BEMBEREKE",
                            "TCHAOUROU",
                            "PARAKOU"
                                "KANDI",
                            "BANIKOARA",
                            "GOGOUNOU",
                            "KARIMAMA",
                            "MALANVILLE",
                            "SEGBANA"
                                "APLAHOUE",
                            "LALO",
                            "TOVIKLIN",
                            "DOGBODJAKOTOMEY",
                            "KLOUEKANME",
                            "TOVIKLIN"
                                "ABOMEY",
                            "BOHICON",
                            "COVE",
                            "DJIDJA",
                            "OUINHI",
                            "ZA-KPOTA",
                            "ZOGBODOMEY",
                            "ZAGNANADO",
                            "AGNANGNIKOUN"
                                "BANTE",
                            "DASSA-ZOUME",
                            "GLAZOUE",
                            "OUESSE",
                            "SAVALOU",
                            "SAVE"
                                "POBE",
                            "SAKETE",
                            "KETOU",
                            "IFANGNI",
                            "ADJA-OUERE"
                                "COTONOU",
                            "ADJARRA",
                            "ADJOHOUN",
                            "AGUEGUE",
                            "DJOUGOU",
                            "AKPRO-MISSERETE",
                            "AVRANKOU",
                            "BONOU",
                            "DANGBO",
                            "PORTO-NOVO"
                          ].map((e) => e).toList(),
                          onChanged: (newValue) {
                            _provider.change_commune(newValue!);
                          }),
                    ),
                    SizedBox(
                      height: 40,
                    ),
                    Container(
                      alignment: Alignment.centerLeft,
                      child: Padding(
                        padding: const EdgeInsets.only(left: 15, bottom: 15),
                        child: Text(
                          "Arrondissement",
                          style: TextStyle(
                              color: Colors.white,
                              fontWeight: FontWeight.bold,
                              fontSize: 20),
                        ),
                      ),
                    ),
                    Padding(
                      padding: const EdgeInsets.only(left: 15),
                      child: DropdownSearch<String>(
                          popupProps: PopupProps.dialog(
                            showSelectedItems: false,
                            showSearchBox: true,
                          ),
                          selectedItem: arrondissement,

                          // ignore: prefer_const_literals_to_create_immutables
                          items: <String>[
                            "BadjoudÃ¨",
                            "KondÃ©",
                            "OuakÃ©",
                            "SÃ¨mÃ¨rÃ¨ I",
                            "SÃ¨mÃ¨rÃ¨ II",
                            "Tchalinga",
                            "Barei",
                            "BariÃ©nou",
                            "BÃ©llÃ©foungou",
                            "Bougou",
                            "Djougou I",
                            "Djougou II",
                            "Djougou III",
                            "KolokondÃ©",
                            "Onklou",
                            "Patargo",
                            "PÃ©lÃ©bina",
                            "SÃ©rou",
                            "Anandana",
                            "Copargo",
                            "PabÃ©gou",
                            "SingrÃ©",
                            "AlÃ©djo",
                            "Bassila",
                            "Manigri",
                            "PÃ©nÃ©ssoulou",
                            "Banikoara",
                            "Founougo",
                            " Gomparou",
                            "Goumori",
                            "Kokey",
                            "Kokiborou",
                            "Ounet",
                            "SompÃ©rÃ©kou",
                            "Soroko",
                            "Toura",
                            "Bagou",
                            "Gogounou",
                            "Gounarou",
                            "Ouara",
                            "Sori",
                            "Zoungou-Pantrossi",
                            "AngaradÃ©bou",
                            "BensÃ©kou",
                            "Donwari",
                            "Kandi I",
                            "Kandi II",
                            "Kandi III",
                            "Kassakou",
                            "Saah",
                            "Sam",
                            "Sonsoro",
                            "Birni Lafia",
                            "Bogo-Bogo",
                            "Karimama",
                            "Kompa",
                            "Monsey",
                            "Garou",
                            "GuÃ©nÃ©2",
                            "Malanville",
                            "MadÃ©cali",
                            "Toumboutou",
                            "LibantÃ¨",
                            "Liboussou",
                            "Lougou",
                            "Segbana",
                            "Sokotindji",
                            "BoukoumbÃ©",
                            "Dipoli",
                            "KorontiÃ¨re",
                            "Kossoucoingou",
                            "Manta",
                            "Natta",
                            "Tabota",
                            "CoblyÃ©",
                            "Datori",
                            "Kountori",
                            "Tapoga",
                            "Brignamaro",
                            "Firou",
                            "KÃ©rou",
                            "Koabagou",
                            "Birni",
                            "Chabi-Couma",
                            " FÃ´-TancÃ©",
                            "Guilmaro",
                            "KouandÃ©",
                            "Oroukayo",
                            "Dassari",
                            "GouandÃ©",
                            "MatÃ©ri",
                            "Nodi",
                            "TantÃ©ga",
                            "Tchianhoun-Cossi",
                            "Kotopounga",
                            "Kouaba",
                            "Koundata",
                            "Natitingou I",
                            "Natitingou II",
                            "Natitingou III",
                            "Natitingou IV",
                            "Perma",
                            "Tchoumi-Tchoumi",
                            "GnÃ©masson",
                            "PÃ©hunco",
                            "TobrÃ©",
                            "Cotiakou",
                            "N'Dahonta",
                            "Taiakou",
                            "TanguiÃ©ta",
                            "Tanongou",
                            "Kouarfa",
                            "TampÃ©grÃ©",
                            "Toucountouna",
                            "Abomey-Calavi",
                            "Akassato",
                            "Godomey",
                            "Glo-DjigbÃ©",
                            "HÃªviÃ©",
                            "Kpanroun",
                            "OuÃ¨do",
                            "Togba",
                            "ZinviÃ©",
                            "Agbanou",
                            "Ahouannonzoun",
                            "Allada",
                            "Attogon",
                            "Avakpa",
                            "Ayou",
                            "Hinvi",
                            "LissÃ¨gazoun",
                            "Lon-Agonmey",
                            "Sekou",
                            "Togoudo",
                            "Tokpa-Avagoudo",
                            "AganmalomÃ¨",
                            "Agbanto",
                            "AgonkanmÃ¨",
                            "DÃ©domÃ¨",
                            "DÃ©kanmÃ¨",
                            "KpomassÃ¨",
                            "SÃ¨gbÃ¨ya",
                            "SÃ¨gbohouÃ¨",
                            "Tokpa-DomÃ¨",
                            "AvlÃ©kÃ©tÃ©",
                            "DjÃ¨gbadji",
                            "GakpÃ©",
                            "HouakpÃ¨-Daho",
                            "Ouidah I",
                            "Ouidah II",
                            "Ouidah III",
                            "Ouidah IV",
                            "Pahou",
                            "Savi",
                            "Ahomey-Lokpo",
                            "DÃ©kanmey",
                            "GanviÃ© I",
                            "GanviÃ© II",
                            "HouÃ©do-AguÃ©kon",
                            "SÃ´-Ava",
                            "Vekky",
                            "AguÃ©",
                            "Colli-AgbamÃ¨",
                            "Coussi",
                            "DamÃ¨",
                            "DjanglanmÃ¨",
                            "HouÃ¨gbo",
                            "KpomÃ¨",
                            "SÃ¨",
                            "SÃ¨houÃ¨",
                            "Toffo-AguÃ©",
                            "AvamÃ¨",
                            "AzohouÃ¨-Aliho",
                            "AzohouÃ¨-Cada",
                            "Tori-Bossito",
                            "Tori-Cada",
                            "Tori-Gare Tori aÃ¯dohoue",
                            "Tori acadjamÃ¨",
                            "Adjan",
                            " DawÃ¨",
                            "DjigbÃ©",
                            "Dodji-Bata",
                            "HÃ¨kanmÃ©",
                            "KoundokpoÃ©",
                            "SÃ¨djÃ¨-DÃ©nou",
                            "SÃ¨djÃ¨-HouÃ©goudo",
                            "Tangbo-DjeviÃ©",
                            "Yokpo",
                            "ZÃ¨",
                            "BembÃ©rÃ©kÃ©",
                            "BÃ©roubouay",
                            "Bouanri",
                            "Gamia",
                            "Ina",
                            "Basso",
                            "Bouka",
                            "DÃ©rassi",
                            "Dunkassa",
                            "KalalÃ©",
                            "PÃ©onga",
                            "Bori",
                            "GbÃ©gourou",
                            "N'Dali",
                            "OuÃ©nou",
                            "Sirarou",
                            "Biro",
                            "Gnonkourakali",
                            "Nikki",
                            "OuÃ©nou",
                            "SÃ©rÃ©kalÃ©",
                            "Suya",
                            "Tasso",
                            "1er arrondissement de Parakou",
                            "2e arrondissement de Parakou",
                            "3e arrondissement de Parakou",
                            "Gninsy",
                            "Guinagourou",
                            "KpanÃ©",
                            "PÃ©biÃ©",
                            "PÃ¨rÃ¨rÃ¨",
                            "Sontou",
                            "FÃ´-BourÃ¨",
                            "SÃ¨kÃ¨rÃ¨",
                            "Sikki",
                            "SinendÃ©",
                            "Alafiarou",
                            "BÃ©tÃ©rou",
                            "Goro",
                            "Kika",
                            "Sanson",
                            "Tchaourou",
                            "Tchatchou",
                            "Agoua",
                            "Akpassi",
                            "AtokoligbÃ©",
                            "BantÃ¨",
                            "BobÃ¨",
                            "Gouka",
                            "Koko",
                            "Lougba",
                            "Pira",
                            "AkofodjoulÃ¨",
                            "Dassa I",
                            "Dassa II",
                            "Gbaffo",
                            "KerÃ¨",
                            "Kpingni",
                            "LÃ¨ma",
                            "Paouignan",
                            "Soclogbo",
                            "TrÃ©",
                            "Aklankpa",
                            "AssantÃ©",
                            "GlazouÃ©",
                            "GomÃ¨",
                            "Kpakpaza",
                            "Magoumi",
                            "OuÃ¨dÃ¨mÃ¨",
                            "Sokponta",
                            "Thio",
                            "ZaffÃ©",
                            "Challa-Ogoi",
                            "DjÃ¨gbÃ¨",
                            "Gbanlin",
                            "KÃ©mon",
                            "Kilibo",
                            "Laminou",
                            "Odougba",
                            "OuÃ¨ssÃ¨",
                            "Toui",
                            "Djaloukou",
                            "DoumÃ¨",
                            "Gobada",
                            "Kpataba",
                            "Lahotan",
                            "LÃ¨ma",
                            "LogozohÃ¨",
                            "Monkpa",
                            "Ottola",
                            "OuÃ¨ssÃ¨",
                            "Savalou-aga",
                            "Savalou-agbado",
                            "Savalou-attakÃ¨",
                            "Tchetti",
                            "Adido",
                            "BÃ¨ssÃ¨",
                            "Boni",
                            "Kaboua",
                            "OfÃ¨",
                            "Okpara",
                            "Plateau",
                            "Sakin",
                            "AplahouÃ©",
                            "AtomÃ¨",
                            "AzovÃ¨",
                            "Dekpo",
                            "Godohou",
                            "Kissamey",
                            "Lonkly",
                            "Adjintimey",
                            "BÃ¨toumey",
                            "Djakotomey I",
                            "Djakotomey II",
                            "Gohomey",
                            "HouÃ¨gamey",
                            "KinkinhouÃ©",
                            "KokohouÃ©",
                            "Kpoba",
                            "SokouhouÃ©",
                            "Ayomi",
                            "DÃ¨vÃ¨",
                            "Honton",
                            "LokogohouÃ©",
                            " MadjrÃ¨",
                            "Tota",
                            "Totchagni",
                            "AdjanhonmÃ¨",
                            "AhogbÃ¨ya",
                            "Aya-HohouÃ©",
                            "Djotto",
                            "Hondji",
                            "KlouÃ©kanmÃ¨",
                            "Lanta",
                            "TchikpÃ©",
                            "Adoukandji",
                            "Ahondjinnako",
                            "Ahomadegbe",
                            "BanigbÃ©",
                            "GnizounmÃ¨",
                            "HlassamÃ¨",
                            "Lalo",
                            "Lokogba",
                            "Tchito",
                            "Tohou",
                            "Zalli",
                            "Adjido",
                            "AvÃ©djin",
                            "Doko",
                            "HouÃ©dogli",
                            "Missinko",
                            "Tannou-Gola",
                            "Toviklin",
                            "1er arrondissement de Cotonou",
                            "2e arrondissement de Cotonou",
                            "3e arrondissement de Cotonou",
                            "4e arrondissement de Cotonou",
                            "5e arrondissement de Cotonou",
                            "6e arrondissement de Cotonou",
                            "7e arrondissement de Cotonou",
                            "8e arrondissement de Cotonou",
                            "9e arrondissement de Cotonou",
                            "10e arrondissement de Cotonou, 11e arrondissement de Cotonou",
                            "12e arrondissement de Cotonou",
                            "13e arrondissement de Cotonou",
                            "Adohoun",
                            "Atchannou",
                            "AthiÃ©mÃ©",
                            "DÃ©dÃ©kpoÃ©",
                            "Kpinnou",
                            "Agbodji",
                            "Badazoui",
                            "Bopa",
                            "Gbakpodji",
                            "Lobogo",
                            "PossotomÃ¨",
                            "YÃ©godoÃ©",
                            "Agatogbo",
                            "AkodÃ©ha",
                            "ComÃ¨",
                            "OuÃ¨dÃ¨mÃ¨-PÃ©dah",
                            "Oumako",
                            "Adjaha",
                            "AgouÃ©",
                            "Avloh",
                            "Djanglanmey",
                            "GbÃ©houÃ©",
                            "Grand-Popo",
                            "SazouÃ©",
                            "DahÃ©",
                            "Doutou",
                            "HonhouÃ©",
                            "HouÃ©yogbÃ©",
                            "SÃ¨",
                            "Zoungbonou",
                            "AgamÃ©",
                            "Houin",
                            "Koudo",
                            "Lokossa",
                            "OuÃ¨dÃ¨mÃ¨",
                            "Adjarra I",
                            "Adjarra II",
                            "AglogbÃ©",
                            "HonviÃ©",
                            "Malanhoui",
                            "MÃ©dÃ©djonou",
                            "Adjohoun",
                            "Akpadanou",
                            "Awonou",
                            "AzowlissÃ¨",
                            "DÃ¨mÃ¨",
                            "Gangban",
                            "KodÃ¨",
                            "Togbota",
                            "Avagbodji",
                            "HouÃ©domÃ¨",
                            "ZoungamÃ¨",
                            "Akpro-MissÃ©rÃ©tÃ©",
                            "GomÃ¨-Sota",
                            "Katagon",
                            "Vakon",
                            "Zodogbomey",
                            "Atchoukpa",
                            "Avrankou",
                            "Djomon",
                            "GbozounmÃ¨",
                            "Kouty",
                            "Ouanho",
                            "Sado",
                            "AffamÃ¨",
                            "Atchonsa",
                            "Bonou",
                            "DamÃ¨-Wogon",
                            "HouinviguÃ¨",
                            " Arrondissements de Dangbo",
                            "Dangbo",
                            "DÃ¨kin",
                            "GbÃ©ko",
                            "HouÃ©domey",
                            "Hozin",
                            "KÃ©ssounou",
                            "ZounguÃ¨",
                            "1er arrondissement",
                            "2e arrondissement",
                            "3e arrondissement",
                            "4e arrondissement",
                            "5e arrondissement",
                            "Agblangandan",
                            "AholouyÃ¨mÃ¨",
                            "DjÃ¨rÃ¨gbÃ¨",
                            "EkpÃ¨",
                            "SÃ¨mÃ¨-Kpodji",
                            "TohouÃ¨",
                            "Adja-OuÃ¨rÃ¨",
                            "IkpinlÃ¨",
                            "Kpoulou",
                            "MassÃ¨",
                            "Oko-AkarÃ¨",
                            "Totonnoukon",
                            "BanigbÃ©",
                            "DaagbÃ©",
                            "Ifangni",
                            "Ko-Koumolou",
                            "LagbÃ©",
                            "Tchaada",
                            "AdakplamÃ©",
                            "Idigny",
                            "Kpankou",
                            "KÃ©tou",
                            "Odometa",
                            "Okpometa",
                            "AhoyÃ©yÃ©",
                            "Igana",
                            "Issaba",
                            "PobÃ¨",
                            "TowÃ©",
                            "Aguidi",
                            "Ita-DjÃ¨bou",
                            "SakÃ©tÃ© I",
                            "SakÃ©tÃ© II",
                            "Takon",
                            "Yoko",
                            "Agbokpa",
                            "DÃ¨tohou",
                            "DjÃ¨gbÃ¨",
                            "Hounli",
                            "SÃ¨houn",
                            "VidolÃ¨",
                            "ZounzounmÃ¨",
                            "Adahondjigon",
                            "Adingningon",
                            "Agbangnizoun",
                            "Kinta",
                            "Kpota",
                            "LissazounmÃ¨",
                            "SahÃ©",
                            "SiwÃ©",
                            "TanvÃ©",
                            "Zoungoudo",
                            "Agongointo",
                            "Avogbanna",
                            "Bohicon I",
                            "Bohicon II",
                            "Gnidjazoun",
                            "LissÃ¨zoun",
                            "Ouassaho",
                            "Passagon",
                            "Saclo",
                            "SodohomÃ¨",
                            "AdogbÃ©",
                            "Gounli",
                            "HouÃ©ko",
                            "Houen-Hounso",
                            "Lainta-CogbÃ¨",
                            "Naogon",
                            "Soli",
                            "Zogba",
                            "Agondji",
                            "Agouna",
                            "Dan",
                            "Djidja",
                            "DohouimÃ¨",
                            "Gobaix",
                            "Monsourou",
                            "Mougnon",
                            "OungbÃ¨gamÃ¨",
                            "Houto",
                            "Setto",
                            "Zoukon",
                            "Dasso",
                            "Ouinhi",
                            "SagonÃ©",
                            "TohouÃ©",
                            "AllahÃ©",
                            "Assalin",
                            "Houngomey",
                            "KpakpamÃ¨",
                            "Kpozoun",
                            "Za-Kpota",
                            "Za-Tanta",
                            "ZÃ¨ko",
                            "Agonli-HouÃ©gbo",
                            "BanamÃ¨",
                            "N'-Tan",
                            "Dovi",
                            "KpÃ©dÃ©kpo",
                            "Zagnanado",
                            "Akiza",
                            "AvlamÃ¨",
                            "Cana I",
                            "Cana II",
                            "DomÃ¨",
                            "Koussoukpa",
                            "Kpokissa",
                            "Massi",
                            "TanwÃ©-Hessou",
                            "Zogbodomey",
                            "Zoukou"
                          ].map((e) => e.toUpperCase()).toList(),
                          onChanged: (newValue) {
                            _provider.change_arrondissement(newValue!);
                          }),
                    ),
                  ]),
            SizedBox(
              height: 30,
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 12),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Votre nom",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 19,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, right: 15),
              child: TextField(
                controller: nom_controller,
                autocorrect: true,
                enableSuggestions: true,
                decoration: InputDecoration(
                    focusedBorder: OutlineInputBorder(
                        borderSide: nom.isEmpty || nom.length < 3
                            ? BorderSide(color: Colors.red)
                            : BorderSide(color: Colors.blue)),
                    hintStyle: TextStyle(
                      color: Colors.black,
                    ),
                    fillColor: Colors.white,
                    filled: true),
                onChanged: (value) {
                  gestion_commande.change_nom(value, nom_controller);
                },
              ),
            ),
            SizedBox(height: 20),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 12),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Adresse E-Mail",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 19,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, right: 15),
              child: TextField(
                enableSuggestions: true,
                decoration: InputDecoration(
                    focusedBorder: OutlineInputBorder(
                        borderSide: email.isEmpty || !email.contains("@")
                            ? BorderSide(color: Colors.red)
                            : BorderSide(color: Colors.blue)),
                    hintStyle: TextStyle(
                      color: Colors.black,
                    ),
                    fillColor: Colors.white,
                    filled: true),
                onChanged: (value) {
                  gestion_commande.change_email(value);
                },
              ),
            ),
            SizedBox(height: 20),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 12),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Numero(Watsapp par prÃ©ference)",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 19,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, right: 15),
              child: TextField(
                  onTap: () {},
                  keyboardType: TextInputType.number,
                  inputFormatters: [FilteringTextInputFormatter.digitsOnly],
                  maxLength: 8,
                  decoration: InputDecoration(
                      focusedBorder: OutlineInputBorder(
                          borderSide: numero.isEmpty || numero.length < 8
                              ? BorderSide(color: Colors.red)
                              : BorderSide(color: Colors.blue)),
                      hintStyle: TextStyle(
                        color: Colors.black,
                      ),
                      counterText: "",
                      fillColor: Colors.white,
                      filled: true),
                  onChanged: (value) {
                    gestion_commande.change_numero(value);
                  }),
            ),
            SizedBox(height: 20),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 12),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Que voulez-vous acheter ?",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 19,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, right: 15),
              child: TextField(
                  onTap: () {},
                  autocorrect: true,
                  enableSuggestions: true,
                  decoration: InputDecoration(
                      focusedBorder: OutlineInputBorder(
                          borderSide: achat.isEmpty || achat.length < 3
                              ? BorderSide(color: Colors.red)
                              : BorderSide(color: Colors.blue)),
                      hintStyle: TextStyle(
                        color: Colors.black,
                      ),
                      fillColor: Colors.white,
                      filled: true),
                  onChanged: (value) {
                    gestion_commande.change_achat(value);
                  }),
            ),
            SizedBox(
              height: 30,
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 12),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Descrivez la commande",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 19,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, right: 15),
              child: TextField(
                  onTap: () {
                    _speak("DÃ©crivez en dÃ©tail la commande");
                  },
                  autocorrect: true,
                  enableSuggestions: true,
                  decoration: InputDecoration(
                      focusedBorder: OutlineInputBorder(
                          borderSide:
                              description.isEmpty || description.length < 10
                                  ? BorderSide(color: Colors.red)
                                  : BorderSide(color: Colors.blue)),
                      hintStyle: TextStyle(
                        color: Colors.black,
                      ),
                      fillColor: Colors.white,
                      filled: true),
                  onChanged: (value) {
                    gestion_commande.change_description(value);
                  }),
            ),
            SizedBox(
              height: 30,
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 12),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Date de livraison",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 21,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, right: 15),
              child: TextField(
                onTap: () async {
                  _speak(
                      "A quelle date voudriez vous que votre commande vous soit livrÃ©e");
                  DateTime? dateSelectionned = await showDatePicker(
                      context: context,
                      initialDate: DateTime.now(),
                      firstDate: DateTime(1950),
                      lastDate: DateTime(2100));
                  String formatime = dateSelectionned != null
                      ? DateFormat("dd-MM-yyyy").format(dateSelectionned)
                      : "";
                  if (formatime.isNotEmpty) {
                    date_livraison.text = formatime;
                  }
                },
                decoration: InputDecoration(
                    hintStyle: TextStyle(
                      color: Colors.black,
                    ),
                    fillColor: Colors.white,
                    filled: true),
                controller: date_livraison,
              ),
            ),
            SizedBox(height: 20),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 12),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Heure de livraison",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 21,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Padding(
                padding: EdgeInsets.only(top: 8, left: 20, right: 20),
                child: TextFormField(
                  onTap: () async {
                    _speak(
                        "veuillez prÃ©ciser l'heure de livraison de votre commande");
                    TimeOfDay? pickedTime = await showTimePicker(
                        context: context, initialTime: TimeOfDay.now());
                    if (pickedTime != null) {
                      DateTime? parsedTime = DateFormat.Hm()
                          .parse(pickedTime.format(context).toString());
                      String formatTime =
                          DateFormat('HH:mm:ss').format(parsedTime);
                      heure_livraison.text = formatTime;
                    } else {
                      heure_livraison.text = "";
                    }
                  },
                  controller: heure_livraison,
                  autocorrect: true,
                  enableSuggestions: true,
                  decoration: InputDecoration(
                      fillColor: Colors.white,
                      filled: true,
                      hintStyle: TextStyle(color: Colors.black),
                      labelStyle: TextStyle(color: Colors.black)),
                )),
            SizedBox(height: 20),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 12),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Vos exigences pour cette commande(optionnel)",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 19,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Padding(
              padding: const EdgeInsets.only(left: 15, right: 15),
              child: TextField(
                onTap: () {
                  _speak(
                      "Dites nous toutes vos exigences pour cette commande. Cette information n'est pas obligatoire");
                },
                autocorrect: true,
                enableSuggestions: true,
                decoration: InputDecoration(
                    focusedBorder: OutlineInputBorder(
                        borderSide: exigences_client.isEmpty ||
                                exigences_client.length < 3
                            ? BorderSide(color: Colors.red)
                            : BorderSide(color: Colors.blue)),
                    hintStyle: TextStyle(
                      color: Colors.black,
                    ),
                    fillColor: Colors.white,
                    filled: true),
                onChanged: (value) {
                  gestion_commande.change_exigences(value);
                },
              ),
            ),
            SizedBox(height: 20),
            Padding(
              padding: const EdgeInsets.only(left: 15, bottom: 0),
              child: Container(
                  alignment: Alignment.centerLeft,
                  child: Text(
                    "Allez vous venir chercher votre commande ?",
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 18,
                        fontWeight: FontWeight.bold),
                  )),
            ),
            Column(
              children: [
                RadioListTile(
                  title: Text(
                    "oui".toUpperCase(),
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 18,
                        fontWeight: FontWeight.bold),
                  ),
                  value: true,
                  groupValue: venir_chercher,
                  onChanged: (value) {
                    _provider.change_venir_chercher(value!);
                  },
                ),
                RadioListTile(
                  title: Text(
                    "non".toUpperCase(),
                    style: GoogleFonts.alike(
                        color: Colors.white,
                        fontSize: 18,
                        fontWeight: FontWeight.bold),
                  ),
                  value: false,
                  groupValue: venir_chercher,
                  onChanged: (value) {
                    _provider.change_venir_chercher(value!);
                  },
                ),
              ],
            ),
            SizedBox(
              height: 20,
            ),
            venir_chercher
                ? SizedBox(
                    width: MediaQuery.of(context).size.width * 0.9,
                    height: 48,
                    child: ElevatedButton(
                        style: ElevatedButton.styleFrom(
                            backgroundColor: Colors.brown.shade800),
                        onPressed: () async {
                          try {
                            _provider.affiche_true();

                            if (pays.isEmpty ||
                                nom.isEmpty ||
                                nom.length < 3 ||
                                email.isEmpty ||
                                email.length < 6 ||
                                numero.isEmpty ||
                                numero.length < 8 ||
                                achat.isEmpty ||
                                achat.length < 3 ||
                                description.isEmpty ||
                                description.length < 8 ||
                                date_livraison.text.isEmpty ||
                                heure_livraison.text.isEmpty) {
                              _provider.affiche_false();
                              _speak(
                                  "Certaines informations sont mal renseignÃ©es. Merci de corriger");

                              final snakbar = SnackBar(
                                content: Padding(
                                  padding: const EdgeInsets.all(8.0),
                                  child: Text(
                                    "Toutes les informations renseignÃ©es ne sont pas correctes. Merci de corriger !",
                                    textAlign: TextAlign.center,
                                    style: GoogleFonts.lato(
                                        color: Colors.white,
                                        fontSize: 22,
                                        fontWeight: FontWeight.bold),
                                  ),
                                ),
                                backgroundColor:
                                    Colors.redAccent.withOpacity(.8),
                                elevation: 10,
                                behavior: SnackBarBehavior.floating,
                                margin: EdgeInsets.all(5),
                              );
                              ScaffoldMessenger.of(context)
                                  .showSnackBar(snakbar);
                            } else {
                              final result = await FirebaseFirestore.instance
                                  .collection("clients")
                                  .where("email", isEqualTo: email)
                                  .get();
                              is_empty = result.docs.isEmpty;

                              if (is_empty) {
                                await FirebaseFirestore.instance
                                    .collection("clients")
                                    .doc(email)
                                    .set({
                                  "nombre_commande": 1,
                                  "email": email,
                                  "nom": nom.toUpperCase(),
                                  "numero": pays == "BENIN"
                                      ? "+229" + numero
                                      : "+228" + numero,
                                  "departement":
                                      pays == "BENIN" ? departement : "",
                                  "commune": pays == "BENIN" ? commu : "",
                                  "arrondissement":
                                      pays == "BENIN" ? arrondissement : "",
                                  "created_at": DateTime.now()
                                });

                                await FirebaseFirestore.instance
                                    .collection("commandes")
                                    .add({
                                  "heure_livraison": heure_livraison.text,
                                  "traite": false,
                                  "client_uid": email,
                                  "achat": "achat de " + achat,
                                  "description": description,
                                  "exigences": exigences_client,
                                  "date_livraison": date_livraison.text,
                                  "venir_chercher_commande": venir_chercher,
                                  "supporter_frais_transport": false,
                                  "created_at": DateTime.now(),
                                  "updated_at": DateTime.now(),
                                  "coordonnees_gps": "",
                                  "indication": ""
                                });
                              } else {
                                await FirebaseFirestore.instance
                                    .collection("clients")
                                    .doc(email)
                                    .get()
                                    .then((DocumentSnapshot document) {
                                  nombre = (document.data()
                                      as Map)['nombre_commande'];
                                });
                                nombre += 1;
                                await FirebaseFirestore.instance
                                    .collection("clients")
                                    .doc(email)
                                    .update({"nombre_commande": nombre});

                                await FirebaseFirestore.instance
                                    .collection("commandes")
                                    .add({
                                  "heure_livraison": heure_livraison.text,
                                  "traite": false,
                                  "client_uid": email,
                                  "achat": "achat de " + achat,
                                  "description": description,
                                  "exigences": exigences_client,
                                  "date_livraison": date_livraison.text,
                                  "venir_chercher_commande": venir_chercher,
                                  "supporter_frais_transport": false,
                                  "created_at": DateTime.now(),
                                  "updated_at": DateTime.now(),
                                  "coordonnees_gps": "",
                                  "indication": ""
                                });
                              }
                              String username = 'agripiyalo@gmail.com';
                              String _password = 'ghcaxojthaqzmhdc';

                              final smtpServer = gmail(username, _password);
                              // Use the SmtpServer class to configure an SMTP server:
                              // final smtpServer = SmtpServer('smtp.domain.com');
                              // See the named arguments of SmtpServer for further configuration
                              // options.

                              // Create our message.
                              final message = Message()
                                ..from =
                                    Address(username, 'Agri Pitalo Entreprise')
                                ..recipients.add(email.trim())
                                ..ccRecipients
                                //.addAll(['destCc1@example.com', 'destCc2@example.com'])
                                //..bccRecipients.add(Address('bccAddress@example.com'))
                                ..subject = "Commande passÃ©e"
                                ..text = " " +
                                    nom +
                                    " \n Votre commande a Ã©tÃ© enregistrÃ©e avec succÃ¨s. Elle sera prete avant la date de livraison que vous avez dÃ©mandÃ©e. Nous vous garantissons aussi de prendre en compte toutes vos exigences. \n Merci pour la confiance, cher client";
                              //..html = "<h1>Test</h1>\n<p>Hey! Here's some HTML content</p>";

                              final sendReport =
                                  await send(message, smtpServer);

                              _provider.affiche_false();
                              _speak(
                                  "Votre commande a Ã©tÃ© enregistrÃ©e avec succÃ¨s");

                              final snakbar = SnackBar(
                                content: Padding(
                                  padding: const EdgeInsets.all(8.0),
                                  child: Text(
                                    "Commande enregistrÃ©e avec succÃ¨s",
                                    textAlign: TextAlign.center,
                                    style: GoogleFonts.lato(
                                        color: Colors.white,
                                        fontSize: 22,
                                        fontWeight: FontWeight.bold),
                                  ),
                                ),
                                backgroundColor: Colors.black87,
                                elevation: 10,
                                behavior: SnackBarBehavior.floating,
                                margin: EdgeInsets.all(5),
                              );
                              ScaffoldMessenger.of(context)
                                  .showSnackBar(snakbar);
                            }
                          } catch (e) {
                            _provider.affiche_false();
                            _speak(
                                "Une erreur inattendue est survenue. Merci de rÃ©essayer");

                            final snakbar = SnackBar(
                              content: Padding(
                                padding: const EdgeInsets.all(8.0),
                                child: Text(
                                  /*"Une erreur inattendue s'est produite !!"*/ e
                                      .toString(),
                                  textAlign: TextAlign.center,
                                  style: GoogleFonts.lato(
                                      color: Colors.white,
                                      fontSize: 22,
                                      fontWeight: FontWeight.bold),
                                ),
                              ),
                              backgroundColor: Colors.redAccent.withOpacity(.8),
                              elevation: 10,
                              behavior: SnackBarBehavior.floating,
                              margin: EdgeInsets.all(5),
                            );
                            ScaffoldMessenger.of(context).showSnackBar(snakbar);
                          }
                        },
                        child: affiche
                            ? CircularProgressIndicator(
                                color: Colors.cyan,
                              )
                            : Text(
                                "Lancer la commande".toUpperCase(),
                                textAlign: TextAlign.center,
                                style: GoogleFonts.alike(
                                    color: Colors.white,
                                    fontWeight: FontWeight.bold),
                              )),
                  )
                : SizedBox(
                    width: MediaQuery.of(context).size.width * 0.9,
                    height: 48,
                    child: ElevatedButton(
                        style: ElevatedButton.styleFrom(
                            backgroundColor: Colors.white),
                        onPressed: () {
                          try {
                            _provider.affiche_true();

                            if (pays.isEmpty ||
                                nom.isEmpty ||
                                nom.length < 3 ||
                                email.isEmpty ||
                                email.length < 6 ||
                                numero.isEmpty ||
                                numero.length < 8 ||
                                achat.isEmpty ||
                                achat.length < 3 ||
                                description.isEmpty ||
                                description.length < 8 ||
                                date_livraison.text.isEmpty) {
                              _provider.affiche_false();
                              _speak(
                                  "Certaines informations sont mal renseignÃ©es. Merci de corriger");

                              final snakbar = SnackBar(
                                content: Padding(
                                  padding: const EdgeInsets.all(8.0),
                                  child: Text(
                                    "Toutes les informations renseignÃ©es ne sont pas correctes. Merci de corriger !",
                                    textAlign: TextAlign.center,
                                    style: GoogleFonts.lato(
                                        color: Colors.white,
                                        fontSize: 22,
                                        fontWeight: FontWeight.bold),
                                  ),
                                ),
                                backgroundColor:
                                    Colors.redAccent.withOpacity(.8),
                                elevation: 10,
                                behavior: SnackBarBehavior.floating,
                                margin: EdgeInsets.all(5),
                              );
                              ScaffoldMessenger.of(context)
                                  .showSnackBar(snakbar);
                            } else {
                              _provider.affiche_false();
                              Navigator.push(
                                  context,
                                  MaterialPageRoute(
                                      builder: (context) => CommanderSecondPage(
                                          heure_livraison: heure_livraison.text,
                                          pays: pays,
                                          departement: departement,
                                          commune: commu,
                                          arrondissement: arrondissement,
                                          nom: nom,
                                          email: email,
                                          numero: numero,
                                          achat: achat,
                                          description: description,
                                          exigences_cllient: exigences_client,
                                          date_livraison: date_livraison.text,
                                          venir_chercher: venir_chercher)));
                            }
                          } catch (e) {
                            _provider.affiche_false();
                            _speak(
                                "Une erreur inattendue est survenue. Merci de rÃ©essayer");

                            final snakbar = SnackBar(
                              content: Padding(
                                padding: const EdgeInsets.all(8.0),
                                child: Text(
                                  "Une erreur inattendue s'est produite !!",
                                  textAlign: TextAlign.center,
                                  style: GoogleFonts.lato(
                                      color: Colors.white,
                                      fontSize: 22,
                                      fontWeight: FontWeight.bold),
                                ),
                              ),
                              backgroundColor: Colors.redAccent.withOpacity(.8),
                              elevation: 10,
                              behavior: SnackBarBehavior.floating,
                              margin: EdgeInsets.all(5),
                            );
                            ScaffoldMessenger.of(context).showSnackBar(snakbar);
                          }
                        },
                        child: Text(
                          "Finaliser la commande".toUpperCase(),
                          textAlign: TextAlign.center,
                          style: TextStyle(
                              color: Colors.brown.shade800,
                              fontWeight: FontWeight.bold),
                        )),
                  ),
            SizedBox(
              height: 50,
            )
          ],
        ),
      ),
    );
  }
}

Future _speak(String text) async {
  final FlutterTts _flutter_tts = FlutterTts();
  _flutter_tts.setLanguage("Fr");
  _flutter_tts.setSpeechRate(0.5);
  _flutter_tts.setVolume(0.5);
  _flutter_tts.setPitch(1.0);
  _flutter_tts.speak(text);
}
